<% title "Preview" %>

<%- content_for :content_splash do -%>
<%= content_tag :h2, "Preview" %>
<%- end -%>

<p>
  <strong>Email:</strong>
  <%=h @upload.email %>

  <% if @upload.tree.status == 2 %>
    <strong>File:</strong>
    <%= link_to "Download", @upload.dwc_url %> (<%= number_to_human_size @upload.dwc.size %>)
  <% end %>
</p>

<div id="upload-preview">

<div id="tree-wrapper">

<% if @upload.tree.status == 2 %>
  <div id="tree"></div>

  <% content_for :javascript do %>
    <script type="text/javascript">
    <!--//--><![CDATA[//><!--
    jQuery.extend(TREE, {
      "id"     : "<%= @upload.tree.id %>",
      "root"   : "<%= @upload.tree.root.id %>",
      "status" : "<%= @upload.tree.status %>"
    });
    $.jstree._themes = '<%= asset_path "jstree/themes/" %>';
    //--><!]]>
    </script>
  <% end %>
<% end %>

</div>

<% if @upload.tree.statistics && @upload.tree.status == 2 %>
<div id="tree-stats">
  <h3>Basic Statistics</h3>
<ul>
<% @upload.tree.statistics.each do |type,stat| %>
<%= content_tag :li, type.to_s.humanize << ": " << stat.to_s.gsub(/(\d)(?=\d{3}+(?:\.|$))(\d{3}\..*)?/,'\1,\2') %>
<% end %>
</ul>
</div>
<% end %>

</div>

