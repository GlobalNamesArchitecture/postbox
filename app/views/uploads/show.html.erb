<% if @upload.tree.status < 3 %>
<% title "Preview" %>

<%- content_for :content_splash do -%>
<%= content_tag :h2, "Preview" %>
<%- end -%>

<% elsif @upload.tree.status == 3 %>

<% title "Submission" %>

<%- content_for :content_splash do -%>
<%= content_tag :h2, "Submission" %>
<%- end -%>

<% end %>

<div id="preview-uploader">
<% if @upload.tree.status < 3 %>
  <h3><%=h @upload.email %></h3>
<% else %>
  <h3><%=h @upload.metadata.contact_givenname %> <%=h @upload.metadata.contact_surname %></h3>
<% end %>
</div>

<div id="upload-preview" class="clear">

<div id="tree-wrapper">
<% if @upload.tree.status > 1 %>
  <div id="tree"></div>

  <% content_for :javascript do %>
    <script type="text/javascript">
    <!--//--><![CDATA[//><!--
    jQuery.extend(TREE, {
      "id"     : "<%= @upload.tree.id %>",
      "root"   : "<%= @upload.tree.root.id %>",
      "status" : "<%= @upload.tree.status %>"
    });
    $.jstree._themes = '<%= asset_path "jstree/themes/" %>';
    //--><!]]>
    </script>
  <% end %>
<% end %>
</div>

<div id="tree-panel-wrapper">
<% if @upload.tree.statistics && @upload.tree.status > 1 %>
<div id="tree-stats" class="panel">
  <h3>Basic Statistics</h3>
<ul>
<% @upload.tree.statistics.each do |type,stat| %>
<%= content_tag :li, type.to_s.humanize << ": " << stat.to_s.gsub(/(\d)(?=\d{3}+(?:\.|$))(\d{3}\..*)?/,'\1,\2') %>
<% end %>
</ul>
</div>
<% if @upload.tree.status == 2 %>
  <%= button_to "Finalize Submission", edit_upload_metadata_path({:upload_id => @upload.token}), :method => :get, :class => "update" %>
<% elsif @upload.tree.status == 3 %>
<div id="tree-download" class="panel">
  <%= link_to "Download", @upload.dwc.url %>
</div>
<% end %>
<% end %>
</div>

</div>

